<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DM Audio</title>
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:transparent;
}
.wrapper{
  display:flex;
  align-items:flex-start;
  gap:8px;
}
.profile{
  width:28px;
  height:28px;
  border-radius:50%;
  object-fit:cover;
}
.bubble{
  background:#5aa6dd;
  padding:14px 18px;
  border-radius:40px;
  width:260px;
  display:flex;
  align-items:center;
}
.playArea{
  flex:0 0 30px;
  display:flex;
  align-items:center;
  justify-content:center;
}
canvas{
  flex:1;
  margin:0 10px;
}
.time{
  font-size:14px;
  color:white;
  font-weight:500;
  width:40px;
  text-align:right;
}
button{
  border:none;
  background:none;
  cursor:pointer;
  padding:0;
}
</style>
</head>
<body>

<div class="wrapper">
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEic-1Xale3WcJcXQaFPE0acXo7gj_9QBz3pKu8lnZ2BkG2XA12Le9oLfTLuGWiXQF8-q3P3f2TG_spnbL8FikU0rt8Ol4UNjER0jw-1u41cQ5byyWa2TmJYpMl0d_tnoX11GxrDq-XM08uMPzvQEe8kE0bA0IE5HH-zitu2ncgDFiKbGM8xSAaeTHObpqCw/s1024/R1280x0.jpeg" class="profile">

  <div>
    <div style="font-size:12px;font-weight:800;color:#6f7782;margin-bottom:6px;">
      AHN HYO SEOP
    </div>

    <div class="bubble">
      <div class="playArea">
        <button id="playBtn">
          <svg id="playIcon" width="18" height="18" viewBox="0 0 24 24">
            <path d="M8 5 L19 12 L8 19 Z" fill="white"/>
          </svg>
          <svg id="pauseIcon" width="18" height="18" viewBox="0 0 24 24" style="display:none;">
            <rect x="6" y="5" width="4" height="14" rx="2" fill="white"/>
            <rect x="14" y="5" width="4" height="14" rx="2" fill="white"/>
          </svg>
        </button>
      </div>

      <canvas id="waveCanvas" width="140" height="30"></canvas>
      <div id="timeDisplay" class="time">0:00</div>
    </div>
  </div>
</div>

<audio id="voiceAudio" crossorigin="anonymous">
  <source src="https://cdn.jsdelivr.net/gh/impaulofview/DMaudio-files/240624_1.mp3" type="audio/mpeg">
</audio>

<script>
const audio=document.getElementById("voiceAudio");
const canvas=document.getElementById("waveCanvas");
const ctx=canvas.getContext("2d");
const playBtn=document.getElementById("playBtn");
const playIcon=document.getElementById("playIcon");
const pauseIcon=document.getElementById("pauseIcon");
const timeDisplay=document.getElementById("timeDisplay");

let waveform=[];
const bars=60;

async function generateWaveform(){
  const response=await fetch(audio.currentSrc);
  const arrayBuffer=await response.arrayBuffer();
  const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  const buffer=await audioCtx.decodeAudioData(arrayBuffer);
  const rawData=buffer.getChannelData(0);
  const blockSize=Math.floor(rawData.length/bars);

  waveform=[];
  for(let i=0;i<bars;i++){
    let sum=0;
    for(let j=0;j<blockSize;j++){
      sum+=Math.abs(rawData[(i*blockSize)+j]);
    }
    waveform.push((sum/blockSize)*45);
  }
  drawWave(0);
}

function drawWave(progress){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const barWidth=canvas.width/bars;
  for(let i=0;i<bars;i++){
    const height=waveform[i]||2;
    const x=i*barWidth;
    const y=canvas.height/2-height/2;
    ctx.fillStyle=i<bars*progress?"white":"rgba(255,255,255,0.35)";
    ctx.fillRect(x,y,barWidth-1.5,height);
  }
}

playBtn.addEventListener("click",()=>{
  if(audio.paused){audio.play();}
  else{audio.pause();}
});

audio.addEventListener("play",()=>{
  playIcon.style.display="none";
  pauseIcon.style.display="block";
});
audio.addEventListener("pause",()=>{
  playIcon.style.display="block";
  pauseIcon.style.display="none";
});
audio.addEventListener("timeupdate",()=>{
  if(audio.duration&&!isNaN(audio.duration)){
    drawWave(audio.currentTime/audio.duration);
    timeDisplay.textContent=formatTime(audio.currentTime);
  }
});
audio.addEventListener("loadedmetadata",()=>{
  if(audio.duration&&!isNaN(audio.duration)){
    timeDisplay.textContent=formatTime(audio.duration);
  }
});
audio.addEventListener("ended",()=>{
  drawWave(0);
});
function formatTime(t){
  const m=Math.floor(t/60);
  const s=Math.floor(t%60);
  return m+":"+(s<10?"0"+s:s);
}
audio.addEventListener("loadeddata",generateWaveform);
</script>

</body>
</html>