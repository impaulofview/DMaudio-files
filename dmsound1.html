<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DM Player</title>

<style>
body{
  margin:0;
  padding:0;
  background:transparent;
  font-family:sans-serif;
}

.wrapper{
  display:flex;
  align-items:flex-start;
  gap:8px;
}

.profile{
  width:28px;
  height:28px;
  border-radius:50%;
  object-fit:cover;
}

.bubble{
  background:#3498db;
  padding:14px 18px;
  border-radius:40px;
  width:260px;
  display:flex;
  align-items:center;
}

.playArea{
  flex:0 0 30px;
  display:flex;
  align-items:center;
  justify-content:center;
}

canvas{
  flex:1;
  margin:0 8px;
}

.time{
  font-size:14px;
  color:white;
  font-weight:500;
  width:40px;
  text-align:right;
}

button{
  border:none;
  background:none;
  cursor:pointer;
  padding:0;
}

/* í™•ëŒ€ ë²„íŠ¼ */
.expandCircle{
  width:44px;
  height:44px;
  border-radius:50%;
  background:#eee;
  display:flex;
  align-items:center;
  justify-content:center;
}

.outsideTime{
  font-size:16px;
  color:#8a8a8a;
  font-weight:500;
}

/* ===== íŒì—… ===== */

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:black;
  z-index:999;
}

.viewer{
  position:relative;
  width:100%;
  height:100%;
}

.viewerTop{
  position:absolute;
  top:20px;
  left:0;
  right:0;
  display:flex;
  justify-content:space-between;
  padding:0 20px;
  color:white;
  font-size:24px;
  z-index:10;
}

.viewerCenter {
  position: relative;          /* ì ˆëŒ€ ìœ„ì¹˜ ì œê±° */
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: flex-start;     /* ì¤‘ì•™ì´ ì•„ë‹Œ ìƒë‹¨ ì •ë ¬ */
  padding-top: 20px;           /* ì˜ìƒ ìœ„ìª½ë§Œ ì‚´ì§ ë„ì›€ */
}

.viewerImage{
  width:220px;
  height:220px;
  border-radius:50%;
  object-fit:cover;
}

video {
  position: static;  /* ì ˆëŒ€ ìœ„ì¹˜ ì œê±° */
  width: 90%;        /* ìµœëŒ€ í­ ì„¤ì • */
  height: auto;      /* ë¹„ìœ¨ ìœ ì§€ */
  object-fit: contain;
}
</style>
</head>

<body>

<div class="wrapper">

  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEic-1Xale3WcJcXQaFPE0acXo7gj_9QBz3pKu8lnZ2BkG2XA12Le9oLfTLuGWiXQF8-q3P3f2TG_spnbL8FikU0rt8Ol4UNjER0jw-1u41cQ5byyWa2TmJYpMl0d_tnoX11GxrDq-XM08uMPzvQEe8kE0bA0IE5HH-zitu2ncgDFiKbGM8xSAaeTHObpqCw/s1024/R1280x0.jpeg" class="profile">

  <div style="flex:1;">

    <div style="font-size:12px;font-weight:800;color:#6f7782;margin-bottom:6px;">
      AHN HYO SEOP
    </div>

    <div style="display:flex; align-items:center; gap:12px;">

      <div class="bubble">

        <div class="playArea">
          <button id="playBtn">
            <svg id="playIcon" width="26" height="26" viewBox="0 0 24 24">
              <path d="M8 5 L19 12 L8 19 Z" fill="white"/>
            </svg>
            <svg id="pauseIcon" width="26" height="26" viewBox="0 0 24 24" style="display:none;">
              <rect x="6" y="5" width="4" height="14" rx="2" fill="white"/>
              <rect x="14" y="5" width="4" height="14" rx="2" fill="white"/>
            </svg>
          </button>
        </div>

        <canvas id="waveCanvas" width="120" height="30"></canvas>

        <div id="timeDisplay" class="time">0:00</div>

      </div>

      <!-- í™•ëŒ€ ë²„íŠ¼ -->

<button id="expandBtn" class="expandCircle">
  <svg width="22" height="22" viewBox="0 0 24 24">
    <!-- ì™¼ìª½ ìœ„ í™”ì‚´í‘œ -->
    <path d="M9 3H3V9M3 3L10 10"
      stroke="#000"
      stroke-width="2.5"
      fill="none"
      stroke-linecap="round"
      stroke-linejoin="round"/>
      
    <!-- ì˜¤ë¥¸ìª½ ì•„ë˜ í™”ì‚´í‘œ -->
    <path d="M15 21H21V15M21 21L14 14"
      stroke="#000"
      stroke-width="2.5"
      fill="none"
      stroke-linecap="round"
      stroke-linejoin="round"/>
  </svg>
</button>

      <!-- ì „ì²´ ì‹œê°„ -->
      <div id="outsideDuration" class="outsideTime">00:00</div>

    </div>
  </div>
</div>

<!-- ì˜¤ë””ì˜¤ (íŒŒí˜•ìš©) -->
<audio id="voiceAudio" crossorigin="anonymous">
  <source src="https://cdn.jsdelivr.net/gh/impaulofview/DMaudio-files/240624_1.mp3" type="audio/mpeg">
</audio>

<!-- íŒì—… -->
<div id="modal" class="modal">
  <div class="viewer">

    <div class="viewerTop">
      <button id="closeBtn">âœ•</button>
      <button id="downloadVideo">â¬‡</button>
    </div>

    <div class="viewerCenter">
      <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEic-1Xale3WcJcXQaFPE0acXo7gj_9QBz3pKu8lnZ2BkG2XA12Le9oLfTLuGWiXQF8-q3P3f2TG_spnbL8FikU0rt8Ol4UNjER0jw-1u41cQ5byyWa2TmJYpMl0d_tnoX11GxrDq-XM08uMPzvQEe8kE0bA0IE5HH-zitu2ncgDFiKbGM8xSAaeTHObpqCw/s1024/R1280x0.jpeg" class="viewerImage">
    </div>

    <video id="videoPlayer" controls>
      <source src="https://cdn.jsdelivr.net/gh/impaulofview/DMaudio-files/240624_1.mp4" type="video/mp4">
    </video>

  </div>
</div>

<script>
const audio=document.getElementById("voiceAudio");
const canvas=document.getElementById("waveCanvas");
const ctx=canvas.getContext("2d");
const playBtn=document.getElementById("playBtn");
const playIcon=document.getElementById("playIcon");
const pauseIcon=document.getElementById("pauseIcon");
const timeDisplay=document.getElementById("timeDisplay");
const expandBtn=document.getElementById("expandBtn");
const modal=document.getElementById("modal");
const closeBtn=document.getElementById("closeBtn");
const downloadVideo=document.getElementById("downloadVideo");
const outsideDuration=document.getElementById("outsideDuration");
const video=document.getElementById("videoPlayer");

let waveform=[];
const bars=50;

async function generateWaveform(){
  const response=await fetch(audio.currentSrc);
  const arrayBuffer=await response.arrayBuffer();
  const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  const buffer=await audioCtx.decodeAudioData(arrayBuffer);
  const rawData=buffer.getChannelData(0);
  const blockSize=Math.floor(rawData.length/bars);

  waveform=[];
  for(let i=0;i<bars;i++){
    let sum=0;
    for(let j=0;j<blockSize;j++){
      sum+=Math.abs(rawData[(i*blockSize)+j]);
    }
    waveform.push((sum/blockSize)*45);
  }
  drawWave(0);
}

function drawWave(progress){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const barWidth=canvas.width/bars;
  for(let i=0;i<bars;i++){
    const height=waveform[i]||2;
    const x=i*barWidth;
    const y=canvas.height/2-height/2;
    ctx.fillStyle=i<bars*progress?"white":"rgba(255,255,255,0.35)";
    ctx.fillRect(x,y,barWidth-1.5,height);
  }
}

function formatTime(t){
  const m=Math.floor(t/60);
  const s=Math.floor(t%60);
  return m+":"+(s<10?"0"+s:s);
}

playBtn.onclick=()=>{
  if(audio.paused){
    audio.currentTime = 0;   // 0ì´ˆë¶€í„° ì‹œì‘
    audio.play();
  }else{
    audio.pause();
  }
};


audio.onplay=()=>{
  playIcon.style.display="none";
  pauseIcon.style.display="block";
};

audio.onpause=()=>{
  playIcon.style.display="block";
  pauseIcon.style.display="none";
};

audio.ontimeupdate=()=>{
  if(audio.duration){
    drawWave(audio.currentTime/audio.duration);
    timeDisplay.textContent=formatTime(audio.currentTime);
  }
};
audio.onloadedmetadata=()=>{
  outsideDuration.textContent = "18:11"; // ğŸ‘ˆ ì›í•˜ëŠ” ê³ ì • ì‹œê°„

    if(audio.duration){
    timeDisplay.textContent = formatTime(audio.duration); // ğŸ‘ˆ ì²˜ìŒì— ì „ì²´ ê¸¸ì´ í‘œì‹œ
  }
};

expandBtn.onclick = () => {
  modal.style.display = "block";
  video.currentTime = 0; // ì˜ìƒ ì²˜ìŒë¶€í„° ì¬ìƒ
  video.play();
};

video.onended = () => {
  modal.style.display = "none"; // ì˜ìƒ ëë‚˜ë©´ íŒì—… ë‹«ê¸°
};

closeBtn.onclick=()=>{
  modal.style.display="none";
  video.pause();
};

downloadVideo.onclick=()=>{
  const link=document.createElement("a");
  link.href="https://cdn.jsdelivr.net/gh/impaulofview/DMaudio-files/240624_1.mp4";
  link.download="video.mp4";
  link.click();
};

audio.addEventListener("loadeddata",generateWaveform);
</script>

</body>
</html>